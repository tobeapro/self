<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			*{margin:0;padding:0;}
			.main{position:relative;margin:0 auto;font-size:0;}
			.box{float:left;padding:6px;}
			.pic{padding:2px;border:1px solid #ddd;border-radius:5px;box-shadow:0 0 5px #ccc;}	
			.pic img{width:300px;height:auto;}					
		</style>
	</head>
	<body>
		<div id="main" class="main">
			<div class="box">		
				<div class="pic">
					<img src="img/21.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/22.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/23.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/24.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/25.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/26.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/27.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/28.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/29.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/30.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/31.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/32.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/33.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/34.png">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/35.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/36.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/37.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/38.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/39.jpg">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/40.png">
				</div>
			</div>
			<div class="box">		
				<div class="pic">
					<img src="img/41.png">
				</div>
			</div>
		</div>
		<script>
			const data=["21.jpg","22.jpg","23.jpg","24.jpg","25.jpg","26.jpg","27.jpg","28.jpg"];
			window.onload=()=>{
				waterfall();
				window.onresize=waterfall; 		
			}
			window.onscroll=()=>{
				let main=document.getElementById("main")
				let adiv=main.getElementsByTagName("*");
				let abox=[];
				for(let j=0;j<adiv.length;j++){
					if(adiv[j].className=="box"){
						abox.push(adiv[j])
					}
				}
				let lbox=abox[abox.length-1];
				let bheight=lbox.offsetHeight+lbox.offsetTop;
				let wheight=document.body.clientHeight||document.documentElement.clientHeight;
				let stop=document.body.scrollTop||document.documentElement.scrollTop;
				if(wheight+stop>=bheight){
					for(let i=0;i<data.length;i++){
						let box=document.createElement("div");
						box.className="box";
						let pic=document.createElement("div");
						pic.className="pic";
						box.appendChild(pic);
						let img=document.createElement("img");
						img.src="img/"+data[i];
						pic.appendChild(img);
						main.appendChild(box);
					}
				}
				waterfall();
			}
			const waterfall=()=>{
					let main=document.getElementById("main");
					let aChild=main.getElementsByTagName("*");
					let aBox=[];
					for(let i=0;i<aChild.length;i++){
						if(aChild[i].className=="box"){
							aBox.push(aChild[i]);
						}
					}
					let Mwidth=document.documentElement.clientWidth;
					let boxWidth=aBox[0].offsetWidth;
					let rowNum=Math.floor(Mwidth/boxWidth);
					main.style.width=rowNum*boxWidth+"px";
					let hArray=[];
					for(let j=0;j<aBox.length;j++){
						if(j<rowNum){
							aBox[j].style.position="static";
							hArray[j]=aBox[j].offsetHeight;
							
						}else{
							let height=getMin(hArray);
							let index=getIndex(height,hArray);
							aBox[j].style.position="absolute";
							aBox[j].style.left=index*boxWidth+"px";
							aBox[j].style.top=hArray[index]+"px";
							hArray[index]+=aBox[j].offsetHeight;
						}
					}
				}	
				const getMin=(array)=>{
					var min=array[0]
					for(var i=0;i<array.length;i++){
						if(min>array[i]){
							min=array[i];
						}
					}
					return min;
				}
				const getIndex=(val,array)=>{
					for(var k=0;k<array.length;k++){
						if(array[k]==val){
							return k
						}
					}
				}				
		</script>
	</body>
</html>
